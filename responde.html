<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insolfége - Feedback</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <style>
        :root {
            --color-dark: #190019;
            --color-mid: #2b124c;
            --color-accent: #522858;
            --color-light: #854F6C;
            --color-bg: #dfB6B2;
            --color-cream: #FBE4D8;
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            background: linear-gradient(135deg, var(--color-bg), var(--color-accent));
            position: relative;
            color: var(--color-cream);
        }

        .container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
        }

        .content-wrapper {
            flex: 1 1 45%;
            max-width: 500px;
            padding: 20px;
            text-align: center;

            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .feeling-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .btn-primary {
            background: var(--color-accent);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: var(--color-light);
        }
	/* Menú de Navegación */
.navbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: var(--color-dark);
    color: white;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    z-index: 1000;
}

.logo {
    font-weight: bold;
    font-size: 1.2rem;
}

.menu ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    gap: 2rem;
}

.menu a {
    color: white;
    text-decoration: none;
    transition: color 0.3s;
}

.menu a:hover {
    color: var(--color-bg);
}

.hamburger {
    display: none;
    flex-direction: column;
    gap: 3px;
    cursor: pointer;
}

.hamburger span {
    width: 25px;
    height: 3px;
    background: white;
    transition: transform 0.3s;
}

/* Responsive Design */
@media (max-width: 600px) {
    .menu {
        position: fixed;
        top: 60px;
        right: 0;
        width: 250px;
        height: calc(100vh - 60px);
        background: var(--color-dark);
        padding: 1rem;
        transform: translateX(100%);
        transition: transform 0.3s;
    }

    .menu.active {
        transform: translateX(0);
    }

    .menu ul {
        flex-direction: column;
        gap: 1rem;
    }

    .hamburger {
        display: flex;
    }
}
    </style>
</head>
<body>
    <header class="navbar">
        <div class="logo">Insolfége</div>
        <nav class="menu">
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="registro.html">Registro</a></li>
                <li><a href="humor.html" class="problem-card-link">Estado de Ánimo</a></li>
                <li><a href="sueno.html" class="problem-card-link">Calidad del Sueño</a></li>
                <li><a href="reproductor.html"class="problem-card-link">Sonidos Binaurales</a></li>

            </ul>
        </nav>
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </header>

    <div class="container">
        <div class="content-wrapper">
            <h2>Evaluación de Experiencia</h2>

            <form id="feedbackForm">
                <!-- Síntomas -->
                <div class="form-group">
                    <label>¿Con qué frecuencia sientes estos síntomas? (1=Nunca, 5=Siempre)</label>

                    <div class="symptom-item">
                        <span>Ansiedad:</span>
                        <div class="radio-group">
                            <label><input type="radio" name="ansiedad" value="1" required>1</label>
                            <label><input type="radio" name="ansiedad" value="2">2</label>
                            <label><input type="radio" name="ansiedad" value="3">3</label>
                            <label><input type="radio" name="ansiedad" value="4">4</label>
                            <label><input type="radio" name="ansiedad" value="5">5</label>
                        </div>
                    </div>

                    <div class="symptom-item">
                        <span>Cansancio mental:</span>
                        <div class="radio-group">
                            <label><input type="radio" name="cansancio" value="1" required>1</label>
                            <label><input type="radio" name="cansancio" value="2">2</label>
                            <label><input type="radio" name="cansancio" value="3">3</label>
                            <label><input type="radio" name="cansancio" value="4">4</label>
                            <label><input type="radio" name="cansancio" value="5">5</label>
                        </div>
                    </div>

                    <div class="symptom-item">
                        <span>Dificultad para dormir:</span>
                        <div class="radio-group">
                            <label><input type="radio" name="dificultadDormir" value="1" required>1</label>
                            <label><input type="radio" name="dificultadDormir" value="2">2</label>
                            <label><input type="radio" name="dificultadDormir" value="3">3</label>
                            <label><input type="radio" name="dificultadDormir" value="4">4</label>
                            <label><input type="radio" name="dificultadDormir" value="5">5</label>
                        </div>
                    </div>

                    <div class="symptom-item">
                        <span>Estrés por trabajo/estudios:</span>
                        <div class="radio-group">
                            <label><input type="radio" name="estres" value="1" required>1</label>
                            <label><input type="radio" name="estres" value="2">2</label>
                            <label><input type="radio" name="estres" value="3">3</label>
                            <label><input type="radio" name="estres" value="4">4</label>
                            <label><input type="radio" name="estres" value="5">5</label>
                        </div>
                    </div>
                </div>

                <!-- Uso de la app -->
                <div class="form-group">
                    <label>¿Cuántas veces has usado la app esta semana?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="usoApp" value="1-2" required>1-2 veces</label>
                        <label><input type="radio" name="usoApp" value="3-5">3-5 veces</label>
                        <label><input type="radio" name="usoApp" value="+5">Más de 5</label>
                    </div>
                </div>

                <!-- Efectividad 134Hz -->
                <div class="form-group">
                    <label>¿La frecuencia 134Hz te pareció efectiva?</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="efectividad" value="dormir">Para dormir</label>
                        <label><input type="checkbox" name="efectividad" value="relajarme">Para relajarme</label>
                        <label><input type="checkbox" name="efectividad" value="animo">Levantar ánimo</label>
                        <label>
                            <input type="checkbox" name="efectividad" value="otro">
                            Otro: <input type="text" name="otroEfecto" disabled>
                        </label>
                    </div>
                </div>

                <!-- Sentimientos post-uso -->
                <div class="form-group">
                    <label>Después de usar la app, ¿cómo te sentiste?</label>
                    <div class="feeling-group">
                        <div>
                            <span>Más relajado/a:</span>
                            <label><input type="radio" name="relajado" value="si" required>Sí</label>
                            <label><input type="radio" name="relajado" value="no">No</label>
                        </div>
                        <div>
                            <span>Más enfocado/a:</span>
                            <label><input type="radio" name="enfocado" value="si" required>Sí</label>
                            <label><input type="radio" name="enfocado" value="no">No</label>
                        </div>
                        <div>
                            <span>Mejor ánimo:</span>
                            <label><input type="radio" name="animo" value="si" required>Sí</label>
                            <label><input type="radio" name="animo" value="no">No</label>
                        </div>
                        <div>
                            <span>Listo para dormir:</span>
                            <label><input type="radio" name="sueno" value="si" required>Sí</label>
                            <label><input type="radio" name="sueno" value="no">No</label>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn-primary">Enviar Evaluación</button>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCyU6h56zzEtuJRr4JbNITCel9Z_K5HYQI",
            authDomain: "registreruser-42ae0.firebaseapp.com",
            projectId: "registreruser-42ae0",
            storageBucket: "registreruser-42ae0.firebasestorage.app",
            messagingSenderId: "676582374312",
            appId: "1:676582374312:web:9c3545678ecbc801a2bb9d"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Obtener userId
        const params = new URLSearchParams(window.location.search);
        const userId = params.get('userId') || localStorage.getItem('userId');

        if (!userId) {
            alert("Acceso no autorizado");
            window.location.href = 'login.html';
        }
        document.addEventListener('DOMContentLoaded', () => {
        const userId = params.get('userId') || localStorage.getItem('userId');
        if (userId) {
            document.querySelectorAll('.problem-card-link').forEach(link => {
                const url = new URL(link.href, window.location.origin);
                url.searchParams.set('userId', userId);
                link.href = url.toString();
            });
        }
    });

        // Manejo del checkbox "Otro"
        document.querySelector('input[value="otro"]').addEventListener('change', (e) => {
            const otroInput = document.querySelector('input[name="otroEfecto"]');
            otroInput.disabled = !e.target.checked;
            if (e.target.checked) otroInput.focus();
        });

        // Envío del formulario
        document.getElementById('feedbackForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Recolectar datos
            const efectividadChecks = Array.from(
                document.querySelectorAll('input[name="efectividad"]:checked')
            ).map(cb => cb.value);

            const data = {
                userId: userId,
                ansiedad: document.querySelector('input[name="ansiedad"]:checked').value,
                cansancio: document.querySelector('input[name="cansancio"]:checked').value,
                dificultadDormir: document.querySelector('input[name="dificultadDormir"]:checked').value,
                estres: document.querySelector('input[name="estres"]:checked').value,
                usoApp: document.querySelector('input[name="usoApp"]:checked').value,
                efectividad: efectividadChecks.includes('otro')
                    ? [...efectividadChecks.filter(e => e !== 'otro'), document.querySelector('input[name="otroEfecto"]').value]
                    : efectividadChecks,
                relajado: document.querySelector('input[name="relajado"]:checked').value,
                enfocado: document.querySelector('input[name="enfocado"]:checked').value,
                animo: document.querySelector('input[name="animo"]:checked').value,
                sueno: document.querySelector('input[name="sueno"]:checked').value,
                timestamp: new Date()
            };

            try {
                await addDoc(collection(db, "usuarios", userId, "feedback"), data);
                alert("¡Gracias por tu feedback!");
                document.getElementById('feedbackForm').reset();
            } catch (error) {
                console.error("Error:", error);
                alert("Error al enviar. Inténtalo más tarde.");
            }
        });
    </script>
</body>
</html>
